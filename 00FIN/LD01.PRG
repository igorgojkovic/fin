ROCEDURE LD1P
PUBLIC MLDMES
save screen to ekr1
LDBAZEP()
@ 0,0 CLEAR
HELP1=77
MSEL=SELECT()
SELECT 25
TTLD=AAKTDIR+'\'+'TTLD.DBF'
if NETUSE(TTLD,.F.,3)
ELSE
RETURN
ENDIF
IF LASTREC()=0
IF ADDREC(3)
UNLOCK
ENDIF
ENDIF
MKD='00'

KOJEBR='L0'
************IZBOR MESECA****************************
da1=.t.
DO WHILE da1
@ 0,0 CLEAR TO 24,79
@ 1,2 SAY' ZA IZBOR MESECA'
IF RECLOCK(3)
   @ 1,2 SAY ' REDNI BROJ ISPLATE ' GET LRED RANGE 1,4
   @ 2,2 SAY ' VRSTA ZARADE 0-REDOVAN RAD,1-PORODILJE,2-BOLOVANJE,3-INVALIDI '
   @ 3,2 SAY ' 4-PRIPRAVNICI' GET EVRSTA RANGE 0,4
   READ
   UNLOCK
ENDIF
MEVRSTA=EVRSTA

IF EVRSTA=0
   AK=''
   ZARVRSTA='ZARADA'
ELSEIF EVRSTA=1
   AK='P'
   ZARVRSTA='PORODILJE'
ELSEIF EVRSTA=2
   AK='L'
   ZARVRSTA='BOLOVANJE'
ELSEIF EVRSTA=3
   AK='I'
   ZARVRSTA='INVALIDI'
ELSE
   AK='R'
   ZARVRSTA='PRIPRAV.'
ENDIF
USE


@ 4,2 SAY'IZBOR MESECA ZA KOJI SE VRSI OBRACUN LICNOG DOHOTKA'
KOJEJE=0
@ 6,15 SAY' PRVI OBRACUN     DRUGI OBRACUN   TRECI OBRACUN'
@ 8,15 PROMPT 'januar     '
@ 9,15 PROMPT 'februar    ' 
@ 10,15 PROMPT 'mart      '
@ 11,15 PROMPT 'april     '
@ 12,15 PROMPT 'maj       '
@ 13,15 PROMPT 'jun       '
@ 14,15 PROMPT 'jul       '
@ 15,15 PROMPT 'avgust    '
@ 16,15 PROMPT 'septembar '
@ 17,15 PROMPT 'oktobar   '
@ 18,15 PROMPT 'novembar  '
@ 19,15 PROMPT 'decembar  '
@ 8,30 PROMPT 'januar     '
@ 9,30 PROMPT 'februar    ' 
@ 10,30 PROMPT 'mart      '
@ 11,30 PROMPT 'april     '
@ 12,30 PROMPT 'maj       '
@ 13,30 PROMPT 'jun       '
@ 14,30 PROMPT 'jul       '
@ 15,30 PROMPT 'avgust    '
@ 16,30 PROMPT 'septembar '
@ 17,30 PROMPT 'oktobar   '
@ 18,30 PROMPT 'novembar  '
@ 19,30 PROMPT 'decembar  '
@ 8,45 PROMPT 'januar     '
@ 9,45 PROMPT 'februar    '
@ 10,45 PROMPT 'mart      '
@ 11,45 PROMPT 'april     '
@ 12,45 PROMPT 'maj       '
@ 13,45 PROMPT 'jun       '
@ 14,45 PROMPT 'jul       '
@ 15,45 PROMPT 'avgust    '
@ 16,45 PROMPT 'septembar '
@ 17,45 PROMPT 'oktobar   '
@ 18,45 PROMPT 'novembar  '
@ 19,45 PROMPT 'decembar  '
@ 20,45 PROMPT 'neizabrano'
menu to KOJEJE

DO CASE 
CASE KOJEJE=1
kojeime='JANUAR    '
KOJEBR='L1'+AK
MKD='01'
CASE KOJEJE=2
kojeime='FEBRUAR   '
KOJEBR='L2'+AK
MKD='02'
CASE KOJEJE=3
kojeime='MART      '
KOJEBR='L3'+AK
MKD='03'
CASE KOJEJE=4
kojeime='APRIL     '
KOJEBR='L4'+AK
MKD='04'
CASE KOJEJE=5
kojeime='MAJ       '
KOJEBR='L5'+AK
MKD='05'
CASE KOJEJE=6
kojeime='JUN       '
KOJEBR='L6'+AK
MKD='06'
CASE KOJEJE=7
kojeime='JUL       '
KOJEBR='L7'+AK
MKD='07'
CASE KOJEJE=8
kojeime='AVGUST    '
KOJEBR='L8'+AK
MKD='08'
CASE KOJEJE=9
kojeime='SEPTEMBAR '
KOJEBR='L9'+AK
MKD='09'
CASE KOJEJE=10
kojeime='OKTOBAR   '
KOJEBR='L10'+AK
MKD='10'
CASE KOJEJE=11
kojeime='NOVEMBAR  '
KOJEBR='L11'+AK
MKD='11'
CASE KOJEJE=12
kojeime='DECEMBAR  '
KOJEBR='L12'+AK
MKD='12'
CASE KOJEJE=13
kojeime='JANUAR 2  '
KOJEBR='L13'+AK
MKD='01'
CASE KOJEJE=14
kojeime='FEBRUAR 2 '
KOJEBR='L14'+AK
MKD='02'
CASE KOJEJE=15
kojeime='MART 2    '
KOJEBR='L15'+AK
MKD='03'
CASE KOJEJE=16
kojeime='APRIL 2   '
KOJEBR='L16'+AK
MKD='04'
CASE KOJEJE=17
kojeime='MAJ 2     '
KOJEBR='L17'+AK
MKD='05'
CASE KOJEJE=18
kojeime='JUN 2     '
KOJEBR='L18'+AK
MKD='06'
CASE KOJEJE=19
kojeime='JUL 2     '
KOJEBR='L19'+AK
MKD='07'
CASE KOJEJE=20
kojeime='AVGUST 2  '
KOJEBR='L20'+AK
MKD='08'
CASE KOJEJE=21
kojeime='SEPTEMBAR 2'
KOJEBR='L21'+AK
MKD='09'
CASE KOJEJE=22
kojeime='OKTOBAR 2  '
KOJEBR='L22'+AK
MKD='10'
CASE KOJEJE=23
kojeime='NOVEMBAR 2'
KOJEBR='L23'+AK
MKD='11'
CASE KOJEJE=24
kojeime='DECEMBAR 2'
KOJEBR='L24'+AK
MKD='12'
CASE KOJEJE=25
kojeime='JANUAR 3  '
KOJEBR='L25'+AK
MKD='01'
CASE KOJEJE=26
kojeime='FEBRUAR 3 '
KOJEBR='L26'+AK
MKD='02'
CASE KOJEJE=27
kojeime='MART 3    '
KOJEBR='L27'+AK
MKD='03'
CASE KOJEJE=28
kojeime='APRIL 3   '
KOJEBR='L28'+AK
MKD='04'
CASE KOJEJE=29
kojeime='MAJ 3     '
KOJEBR='L29'+AK
MKD='05'
CASE KOJEJE=30
kojeime='JUN 3     '
KOJEBR='L30'+AK
MKD='06'
CASE KOJEJE=31
kojeime='JUL 3     '
KOJEBR='L31'+AK
MKD='07'
CASE KOJEJE=32
kojeime='AVGUST 3  '
KOJEBR='L32'+AK
MKD='08'
CASE KOJEJE=33
kojeime='SEPTEMBAR 3'
KOJEBR='L33'+AK
MKD='09'
CASE KOJEJE=34
kojeime='OKTOBAR 3  '
KOJEBR='L34'+AK
MKD='10'
CASE KOJEJE=35
kojeime='NOVEMBAR 3'
KOJEBR='L35'+AK
MKD='11'
CASE KOJEJE=36
kojeime='DECEMBAR 3'
KOJEBR='L36'+AK
MKD='12'
CASE KOJEJE=37
kojeime='MESEC NIJE IZABRAN '
KOJEBR='L0'+AK
MKD='00'
OTHERWISE
kojeime='MESEC NIJE IZABRAN '
KOJEBR='L0'+AK
ENDCASE


MSEL=SELECT()
SELECT 25
USE LPTEXT SHARED
IF LASTREC()=0
   IF ADDREC(3)
      REPLACE LP1 WITH ' Potvrda se izdaje na licni zahtev imenovanog radi          '
      REPLACE LP2 WITH ' regulisanja prava iz______________________________________ '
      REPLACE LP3 WITH ' __________________________________________________________ '
      REPLACE LP4 WITH ' i u druge svrhe se ne moze upotrebiti.                     '
      REPLACE LP5 WITH ' SASTAVIO                                     ODGOVORNO LICE'
      UNLOCK
   ENDIF
ENDIF
USE
SELECT &MSEL

MSEL=SELECT()
SELECT 25
TTLD=AAKTDIR+'\'+'TTLD.DBF'
if NETUSE(TTLD,.F.,3)
ELSE
RETURN
ENDIF
IF LASTREC()=0
IF ADDREC(3)
UNLOCK
ENDIF
ENDIF
USE
TTLD=AAKTDIR+'\'+'TTLD.DBF'
if NETUSE(TTLD,.F.,3)
ELSE
RETURN
ENDIF
SET COLOR TO &BOJAHELP
@ 22,0 CLEAR TO 24,79
@ 22,0 TO 24,79
IF RECLOCK(3)
   IF LRED=0
      REPLACE LRED WITH 1
   ENDIF
   REPLACE KD22 WITH MKD
   UNLOCK
ENDIF
LDREDISP=LRED
USE
SELECT &MSEL

USE LDSAMOD
IF LDREDISP=1
IF FILLOCK(3)
   REPLACE ALL AKO1 WITH 0
   REPLACE ALL NET1 WITH 0
   REPLACE ALL AKO2 WITH 0
   REPLACE ALL NET2 WITH 0
   REPLACE ALL AKO3 WITH 0
   REPLACE ALL NET3 WITH 0
   REPLACE ALL AKO4 WITH 0
   REPLACE ALL NET4 WITH 0
   REPLACE ALL NETOLD WITH 0
   REPLACE ALL IZNOS WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=2
IF FILLOCK(3)
   REPLACE ALL AKO2 WITH 0
   REPLACE ALL NET2 WITH 0
   REPLACE ALL AKO3 WITH 0
   REPLACE ALL NET3 WITH 0
   REPLACE ALL AKO4 WITH 0
   REPLACE ALL NET4 WITH 0
   REPLACE ALL NETOLD WITH 0
   REPLACE ALL IZNOS WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=3
IF FILLOCK(3)
   REPLACE ALL AKO3 WITH 0
   REPLACE ALL NET3 WITH 0
   REPLACE ALL AKO4 WITH 0
   REPLACE ALL NET4 WITH 0
   REPLACE ALL NETOLD WITH 0
   REPLACE ALL IZNOS WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=4
IF FILLOCK(3)
   REPLACE ALL AKO4 WITH 0
   REPLACE ALL NET4 WITH 0
   REPLACE ALL NETOLD WITH 0
   REPLACE ALL IZNOS WITH 0
   UNLOCK ALL
ENDIF
ENDIF
USE
*************************************************
IF KOJEBR='L0'
@ 0,0 CLEAR TO 24,79
@ 10,2 SAY' NIJE IZABRAN NI JEDAN MESEC - bilo sta za izlaz '
inkey(0)
EXIT
ENDIF

MMESEC=ALLTRIM(KOJEBR)
MMESECB=ALLTRIM(KOJEBR)+'B'

MLD2POD='LD2POD'+ALLTRIM(STR(KOJEJE))
MLD3POD='LD3POD'+ALLTRIM(STR(KOJEJE))
MLD4POD='LD4POD'+ALLTRIM(STR(KOJEJE))
MLDPPOD='LDPPOD'+ALLTRIM(STR(KOJEJE))
MLDLPOD='LDLPOD'+ALLTRIM(STR(KOJEJE))
MLDIPOD='LDIPOD'+ALLTRIM(STR(KOJEJE))
MLDRPOD='LDRPOD'+ALLTRIM(STR(KOJEJE))
if mevrsta=0
   MLDKON ='LDKON0'+'.DBF'
else
   MLDKON ='LDKON'+alltrim(str(mevrsta,1,0))+'.DBF'
endif
MLN2POD='LN2POD'+ALLTRIM(STR(KOJEJE))
MLN3POD='LN3POD'+ALLTRIM(STR(KOJEJE))
MLN4POD='LN4POD'+ALLTRIM(STR(KOJEJE))
MLNPPOD='LNPPOD'+ALLTRIM(STR(KOJEJE))
MLNLPOD='LNLPOD'+ALLTRIM(STR(KOJEJE))
MLNIPOD='LNIPOD'+ALLTRIM(STR(KOJEJE))
MLNRPOD='LNRPOD'+ALLTRIM(STR(KOJEJE))

MLDTO='LDTO'+ALLTRIM(STR(KOJEJE))
MLDVRE='LDVRE'+ALLTRIM(STR(KOJEJE))
MLDRVRE='LDRVRE'+ALLTRIM(STR(KOJEJE))
MLDPRO='LDPRO'+ALLTRIM(STR(KOJEJE))

MLDMES='LDMES'+ALLTRIM(STR(KOJEJE))
MLDLMES='LDLMES'+ALLTRIM(STR(KOJEJE))
MLDIMES='LDIMES'+ALLTRIM(STR(KOJEJE))
MLDPMES='LDPMES'+ALLTRIM(STR(KOJEJE))
MLDRMES='LDRMES'+ALLTRIM(STR(KOJEJE))

IBAZE(MLDMES,'LDMESTA')
IBAZE(MLDPMES,'LDMESTA')
IBAZE(MLDRMES,'LDMESTA')
IBAZE(MLDLMES,'LDMESTA')
IBAZE(MLDIMES,'LDMESTA')

USE &MLDKON
ZAP
IF MEVRSTA=0
   APPEND FROM LDKON00 FOR VRSTA='0'
ENDIF
IF MEVRSTA=1
   APPEND FROM LDKON00 FOR VRSTA='1'
ENDIF
IF MEVRSTA=2
   APPEND FROM LDKON00 FOR VRSTA='2'
ENDIF
IF MEVRSTA=3
   APPEND FROM LDKON00 FOR VRSTA='3'
ENDIF
IF MEVRSTA=4
   APPEND FROM LDKON00 FOR VRSTA='4'
ENDIF

USE

IF MEVRSTA=0
USE (MLDMES)
IF LDREDISP=1
IF FILLOCK(3)
   REPLACE ALL POR1 WITH 0
   REPLACE ALL PFZ1 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=2
IF FILLOCK(3)
   REPLACE ALL POR2 WITH 0
   REPLACE ALL PFZ3 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=3
IF FILLOCK(3)
   REPLACE ALL POR3 WITH 0
   REPLACE ALL PFZ3 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=4
IF FILLOCK(3)
   REPLACE ALL POR4 WITH 0
   REPLACE ALL PFZ4 WITH 0
   UNLOCK ALL
ENDIF
ENDIF
USE
ENDIF

IF MEVRSTA=1
USE (MLDPMES)
IF LDREDISP=1
IF FILLOCK(3)
   REPLACE ALL POR1 WITH 0
   REPLACE ALL PFZ1 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=2
IF FILLOCK(3)
   REPLACE ALL POR2 WITH 0
   REPLACE ALL PFZ3 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=3
IF FILLOCK(3)
   REPLACE ALL POR3 WITH 0
   REPLACE ALL PFZ3 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=4
IF FILLOCK(3)
   REPLACE ALL POR4 WITH 0
   REPLACE ALL PFZ4 WITH 0
   UNLOCK ALL
ENDIF
ENDIF
USE
ENDIF


IF MEVRSTA=2
USE (MLDLMES)
IF LDREDISP=1
IF FILLOCK(3)
   REPLACE ALL POR1 WITH 0
   REPLACE ALL PFZ1 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=2
IF FILLOCK(3)
   REPLACE ALL POR2 WITH 0
   REPLACE ALL PFZ3 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=3
IF FILLOCK(3)
   REPLACE ALL POR3 WITH 0
   REPLACE ALL PFZ3 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=4
IF FILLOCK(3)
   REPLACE ALL POR4 WITH 0
   REPLACE ALL PFZ4 WITH 0
   UNLOCK ALL
ENDIF
ENDIF
USE
ENDIF

IF MEVRSTA=3
USE (MLDIMES)
IF LDREDISP=1
IF FILLOCK(3)
   REPLACE ALL POR1 WITH 0
   REPLACE ALL PFZ1 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=2
IF FILLOCK(3)
   REPLACE ALL POR2 WITH 0
   REPLACE ALL PFZ3 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=3
IF FILLOCK(3)
   REPLACE ALL POR3 WITH 0
   REPLACE ALL PFZ3 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=4
IF FILLOCK(3)
   REPLACE ALL POR4 WITH 0
   REPLACE ALL PFZ4 WITH 0
   UNLOCK ALL
ENDIF
ENDIF
USE
ENDIF

IF MEVRSTA=4
USE (MLDRMES)
IF LDREDISP=1
IF FILLOCK(3)
   REPLACE ALL POR1 WITH 0
   REPLACE ALL PFZ1 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=2
IF FILLOCK(3)
   REPLACE ALL POR2 WITH 0
   REPLACE ALL PFZ3 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=3
IF FILLOCK(3)
   REPLACE ALL POR3 WITH 0
   REPLACE ALL PFZ3 WITH 0
   UNLOCK ALL
ENDIF
ELSEIF LDREDISP=4
IF FILLOCK(3)
   REPLACE ALL POR4 WITH 0
   REPLACE ALL PFZ4 WITH 0
   UNLOCK ALL
ENDIF
ENDIF
USE
ENDIF

IBAZE(MMESEC,'LD')
IBAZE(MMESECB,'LDB')

   IIND(MMESEC;
        ,'BR';
        ,'MTR';
        ,'VRSIND')
   IIND(MMESECB;
        ,'BR')

IBAZE(MLD2POD,'LD2POD')
IPUNI(MLD2POD,'LD2POD')

   USE &MLD2POD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE

IIND(MLD2POD;
     ,'KOD')

IBAZE(MLD3POD,'LD2POD')
IPUNI(MLD3POD,'LD2POD')
   USE &MLD3POD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE

   IIND(MLD3POD;
       ,'KOD')

IBAZE(MLD4POD,'LD2POD')
IPUNI(MLD4POD,'LD2POD')
   USE &MLD4POD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE

   IIND(MLD4POD;
       ,'KOD')


IBAZE(MLDPPOD,'LD2POD')
IPUNI(MLDPPOD,'LD2POD')
   USE &MLDPPOD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE
   IIND(MLDPPOD;
       ,'KOD')

IBAZE(MLDIPOD,'LD2POD')
IPUNI(MLDIPOD,'LD2POD')
   USE &MLDIPOD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE

IBAZE(MLDLPOD,'LD2POD')
IPUNI(MLDLPOD,'LD2POD')
   USE &MLDLPOD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE


   IIND(MLDLPOD;
       ,'KOD')
   IIND(MLDIPOD;
       ,'KOD')


IBAZE(MLDVRE,'LDVRE')
IBAZE(MLDRPOD,'LD2POD')
IPUNI(MLDRPOD,'LD2POD')

   USE &MLDRPOD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE

   IIND(MLDRPOD;
       ,'KOD')


USE LN2POD
   IF LASTREC()<1
      ODNPUNI(5)
   ENDIF
USE

IBAZE(MLN2POD,'LN2POD')
IPUNI(MLN2POD,'LN2POD')

   USE &MLN2POD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE

IIND(MLN2POD;
     ,'KOD')

IBAZE(MLN3POD,'LN2POD')
IPUNI(MLN3POD,'LN2POD')
   USE &MLN3POD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE

   IIND(MLD3POD;
       ,'KOD')

IBAZE(MLN4POD,'LN2POD')
IPUNI(MLN4POD,'LN2POD')
   USE &MLN4POD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE

   IIND(MLN4POD;
       ,'KOD')


IBAZE(MLNPPOD,'LN2POD')
IPUNI(MLNPPOD,'LN2POD')
   USE &MLNPPOD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE
   IIND(MLNPPOD;
       ,'KOD')

IBAZE(MLNIPOD,'LN2POD')
IPUNI(MLNIPOD,'LN2POD')
   USE &MLNIPOD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE

IBAZE(MLNLPOD,'LN2POD')
IPUNI(MLNLPOD,'LN2POD')
   USE &MLNLPOD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE

   IIND(MLNLPOD;
       ,'KOD')
   IIND(MLNIPOD;
       ,'KOD')


IBAZE(MLNRPOD,'LN2POD')
IPUNI(MLNRPOD,'LN2POD')

   USE &MLNRPOD
   GO TOP
   DO WHILE.NOT.EOF()
      IF RECLOCK(3)
         REPLACE MESEC WITH KOJEIME
         UNLOCK
      ENDIF
      SKIP
   ENDDO
   USE

   IIND(MLNRPOD;
       ,'KOD')

   IIND(MLDVRE;
       ,'GRUPA';
       ,'BR';
       ,'DATUM')

IBAZE(MLDRVRE,'LDRVRE')

   IIND(MLDRVRE;
        ,'BR';
        ,'DATUM')

IBAZE(MLDPRO,'LDPRO')

   IIND(MLDPRO;
        ,'GRUPA';
        ,'VRSTA')

DA1=.F.
ENDDO

MSEL=SELECT()
SELECT 25
TTLD=AAKTDIR+'\'+'TTLD.DBF'
if NETUSE(TTLD,.F.,3)
ELSE
  RETURN
ENDIF
IF RECLOCK(3)
   REPLACE LMIME WITH KOJEIME
   REPLACE LMBROJ WITH KOJEBR
   REPLACE LMJE WITH KOJEJE
   UNLOCK
ENDIF
USE
SELECT &MSEL

CLOSE ALL
restore screen from ekr1
RETURN

*************PROGRAM ZA POCETNO KONFIGURISANJE **************

PROCEDURE LD21P()
LOCAL OD1
save screen to ekr1
SET COLOR TO &BOJA1
@ 0,0 clear

MSEL=SELECT()
SELECT 25
TTLD=AAKTDIR+'\'+'TTLD.DBF'
if NETUSE(TTLD,.F.,3)
ELSE
RETURN
ENDIF
SET COLOR TO &BOJAHELP
@ 22,0 CLEAR TO 24,79
@ 22,0 TO 24,79
LD21P2()
USE
SELECT &MSEL

MSEL=SELECT()
SELECT 25
TTLD=AAKTDIR+'\'+'TTLD.DBF'
if NETUSE(TTLD,.F.,3)
ELSE
RETURN
ENDIF
IF RECLOCK(3)
   @ 0,0 clear to 24,79
   @ 0,0 to 24,79 double
   @ 0,0 to 1,79 double
   @ 1,20 say '   PODACI IZ KOLEKTIVNOG UGOVORA    '
   @ 2,2 say   'SATI U MESECU............'get ESATI PICT '999'
   @ 3,2 say   'SATI PRAZNIKA............'get EPRAZ PICT '999'
   @ 4,2 say   'NOCNI RAD................'get ENOC PICT '999.99'
   @ 5,2 say   'DUZI RAD.................'get EPROD PICT '999.99'
   @ 6,2 say   'RAD NA PRAZNIK...........'get EDEZ PICT '999.99'
   @ 7,2 say   'RAD NEDELJOM.............'get ENED PICT '999.99'
   @ 8,2 say   'PLACENO ODSUSTVO.........'get EPROCPLAC PICT '999.99'
   @ 9,2 say   'MINULI RAD...............'get EMIN PICT '999.99'
   @ 10,2 say  'START=0    PRIMANJA=1....'get ENMIN PICT '9'
   @ 11,2 say  'PREBACAJ CAS=0 BOD=1.....'get ECASBOD PICT '9'
   @ 12,2 say  'ZAKONSKI BROJ SATI.......'get MESCAS  PICT '999'
   @ 13,2 say  'MOGUCI BROJ DANA.........'get EDANA picture '99'
   @ 14,2 say  'KURS EVRA NA DAN ISPLATE.'get ESTAN picture '9999999.9999'
   @ 15,2 say  'BOLOVANJE................'get EPROCBOL picture '999.99'
   @ 16,2 say  'PROSECNA BRUTO ZARADA....'get ELDNCR  PICT'9999,999,999,999.99'
   @ 17,2 say  'BENEFICIJA 14 MES........'Get EB14 PICT '999.99'
   @ 18,2 say  'BENEFICIJA 15 MES........'Get EB15 PICT '999.99'
   @ 19,2 say  'BENEFICIJA 16 MES........'Get EB16 PICT '999.99'
   @ 20,2 say  'BENEFICIJA 18 MES........'Get EB18 PICT '999.99'
   @ 21,2 say  'KOEFICIJENT STARTA.......'Get EKOEFS PICT '999'
   @ 22,2 say  'NACIN OBRACUNA 1/2.......'Get ENACIN PICT '9'
   @ 23,2 say  'DATUM ISPLATE............'Get EDAT   PICT '@D'
   @ 24,02 say  'PORESKO OSLOBADJANJE.....'Get POREZOSL  PICT '999999999.99'
   @ 24,45 say  'MINIMALNA ZARADA.'Get MINIMAL PICT '999999999.99'
   READ
   UNLOCK
ENDIF
USE
SELECT &MSEL

SET COLOR TO &BOJA2
restore screen from ekr1
return
*************PROGRAM ZA POCETNO KONFIGURISANJE **************
PROCEDURE LD22P()
save screen to ekr1
@ 0,0 CLEAR

MSEL=SELECT()
SELECT 25
TTLD=AAKTDIR+'\'+'TTLD.DBF'
if NETUSE(TTLD,.F.,3)
ELSE
RETURN
ENDIF
SET COLOR TO &BOJAHELP
LD21P2()
USE
SELECT &MSEL

MSEL=SELECT()
SELECT 25
TTLD=AAKTDIR+'\'+'TTLD.DBF'
if NETUSE(TTLD,.F.,3)
ELSE
RETURN
ENDIF

IF RECLOCK(3)

  *---------------REDOVAN RAD -----------------------
  @  2,10 say'DOPRINOSI ZA PIO ZDRAVSTVO I NEZAPOSLENOST '
  @ 4,10 SAY'     OPIS   '
  @ 4,43 SAY'RADNIK   '
  @ 4,53 SAY'FIRMA    '

  @  6,10 say'% ZA PENZIJSKO OSIG REDOVAN RAD '
  @  7,10 say'% ZA ZDRAVSTV. OSIG REDOVAN RAD '
  @  8,10 say'% ZA OSIG.NEZAPOSL. REDOVAN RAD '
  @  9,10 say'% ZA SOCIJALNO OSIG REDOVAN RAD '

  @  6,43 Get DRPEN PICT '999.99'
  @  7,43 Get DRZDR PICT '999.99'
  @  8,43 Get DRNEZ PICT '999.99'
  READ
  MDOPSOC=DRPEN+DRZDR+DRNEZ
  @  9,43 SAY MDOPSOC PICT '999.99'

  @  6,53 Get DFPEN PICT '999.99'
  @  7,53 Get DFZDR PICT '999.99'
  @  8,53 GET DFNEZ PICT '999.99'
  READ
  MDOPSOCF=DFPEN+DFZDR+DFNEZ
  @  9,53 SAY MDOPSOCF PICT '999.99'

  *---------PORODILJE-----------------------


  @  11,10 say'% ZA PENZIJSKO OSIG  PORODILJE'
  @  12,10 say'% ZA ZDRAVSTV. OSIG  PORODILJE'
  @  13,10 say'% ZA OSIG.NEZAPOSL.  PORODILJE'
  READ

  @  11,43 Get DPPEN PICT '999.99'
  @  12,43 Get DPZDR PICT '999.99'
  @  13,43 Get DPNEZ PICT '999.99'
  READ
  @  14,10 say'% ZA SOCIJALNO OSIG  '
  MPDOPSOC=DPPEN+DPZDR+DPNEZ
  @  14,43 SAY MPDOPSOC PICT '999.99'


  @  11,53 Get DFPPEN PICT '999.99'
  @  12,53 Get DFPZDR PICT '999.99'
  @  13,53 GET DFPNEZ PICT '999.99'
  READ
  MPDOPSOCF=DFPPEN+DFPZDR+DFPNEZ
  @  14,53 SAY MPDOPSOCF PICT '999.99'

  *---------BOLOVANJE ---------------------


  @  16,10 say'% ZA PENZIJSKO OSIG BOLOVANJE '
  @  17,10 say'% ZA ZDRAVSTV. OSIG BOLOVANJE '
  @  18,10 say'% ZA OSIG.NEZAPOSL. BOLOVANJE '
  READ



  @  16,43 Get DLPEN PICT '999.99'
  @  17,43 Get DLZDR PICT '999.99'
  @  18,43 Get DLNEZ PICT '999.99'
  READ

  @  19,10 say'% ZA SOCIJALNO OSIG  '
  MLDOPSOC=DLPEN+DLZDR+DLNEZ
  @  19,43 SAY MLDOPSOC PICT '999.99'

  @  16,53 Get DFLPEN PICT '999.99'
  @  17,53 Get DFLZDR PICT '999.99'
  @  18,53 GET DFLNEZ PICT '999.99'
  READ
  MLDOPSOCF=DFLPEN+DFLZDR+DFLNEZ
  @  19,53 SAY MLDOPSOCF PICT '999.99'

  *---------INVALIDI---------------------

  @  21,10 say'% ZA PENZIJSKO OSIG INVALIDI  '
  @  22,10 say'% ZA ZDRAVSTV. OSIG INVALIDI  '
  @  23,10 say'% ZA OSIG.NEZAPOSL. INVALIDI  '
  READ



  @  21,43 Get DIPEN PICT '999.99'
  @  22,43 Get DIZDR PICT '999.99'
  @  23,43 Get DINEZ PICT '999.99'
  READ

  @  24,10 say'% ZA SOCIJALNO OSIG  '
  MIDOPSOC=DIPEN+DIZDR+DINEZ
  @  24,43 SAY MLDOPSOC PICT '999.99'


  @  21,53 Get DFIPEN PICT '999.99'
  @  22,53 Get DFIZDR PICT '999.99'
  @  23,53 GET DFINEZ PICT '999.99'
  READ
  MIDOPSOCF=DFIPEN+DFIZDR+DFINEZ
  @  24,53 SAY MIDOPSOCF PICT '999.99'


  UNLOCK
ENDIF
INKEY(2)
USE
SELECT &MSEL
close all
SET COLOR TO &BOJA2
restore screen from ekr1
return


PROCEDURE LD4P()
SAVE SCREEN TO EKRLD4
SET COLOR TO &BOJA2
IZBORP4=1
DO WHILE IZBORP4<>0
   @ 10,15 clear TO 16,32
   @ 10,15,16,32 BOX UG
   @ 7,16 CLEAR TO  9,31
   @ 7,16 TO  9,31 DOUBLE
   @ 8,17 SAY '  AZURIRANJE  '
   POR1='             prenos radnika iz evidencije u platni spisak              '
   POR2='             unos casova u platni spisak na osnovu parametara         '
      @  12,16 PROMPT' PRENOS RADNIKA ' MESS POR1
      @  14,16 PROMPT' UNOS CASOVA    ' MESS POR2
      MENU TO IZBORP4
      IF IZBORP4=1
         LD41P()
      ENDIF
      IF IZBORP4=2
         LD42P()
      ENDIF
   ENDDO IZBORP4<>0
   CLOSE ALL
   SET COLOR TO &BOJA1
   RESTORE SCREEN FROM EKRLD4
   RETURN


*-------------UNOS RADNIKA------------
PROCEDURE LD41P()
   SAVE SCREEN TO EKR212
   SET COLOR TO &BOJA1
   HELP1=77
   do while .t.
   STORE 'Y' TO OD1,OD2,OD3,OD4,OD5,OD6
   @ 9,10 CLEAR TO 14,70
   @ 9,10 TO 14,70
   @ 10,20 SAY 'PROGRAM ZA UNOS RADNIKA  U PLATNI SPISAK'
   **************   PROVERA UNOSA   **********************
   SELECT 25
   TTLD=AAKTDIR+'\'+'TTLD.DBF'
   if NETUSE(TTLD,.F.,3)
      ELSE
         RETURN
      ENDIF
   KOJEBR=LMBROJ
   MEVRSTA=EVRSTA
   SELECT 25
   USE
   Mmesec=alltrim(kojebr)
   MmesecB=alltrim(kojebr)+'B'
   SELECT 1
   use &Mmesec
   IF LASTREC()>0
      @ 12,11 SAY '      VEC JE UNET SPISAK RADNIKA U PLATNI SPISAK '
      inkey(0)
      exit
   ELSE
      @ 12,11 SAY 'UNOS RADNIKA U PLATNI SPISAK Y/N' GET OD2 PICTURE 'Y'
      READ
      IF OD2='Y'
         @ 13,11 SAY 'NE PREKIDAJ RAD RACUNARA VRSI SE UNOS RADNIKA'

         IF MEVRSTA=0

         APPEND FROM LDRAD FOR OBRISANJE<>'*'.AND.(VRSTA=' '.OR.VRSTA='I')
         USE
         USE &MMESECB
         APPEND FROM LDRAD FOR OBRISANJE<>'*'.AND.(VRSTA=' '.OR.VRSTA='I')
         USE

         ELSEIF MEVRSTA=1

         APPEND FROM LDRAD FOR VRSTA='P'
         USE
         USE &MMESECB
         APPEND FROM LDRAD FOR VRSTA='P'
         USE
         ELSEIF MEVRSTA=2

         APPEND FROM LDRAD FOR VRSTA='B'
         USE
         USE &MMESECB
         APPEND FROM LDRAD FOR VRSTA='B'
         USE
         ELSEIF MEVRSTA=3

         APPEND FROM LDRAD FOR VRSTA='I'
         USE
         USE &MMESECB
         APPEND FROM LDRAD FOR VRSTA='I'
         USE
         ELSE

         APPEND FROM LDRAD FOR VRSTA='R'
         USE
         USE &MMESECB
         APPEND FROM LDRAD FOR VRSTA='R'
         USE
         ENDIF


         exit
      endif
      exit
   endif
enddo
close all
SET COLOR TO &BOJA2
restore screen from ekr212
return

*************PROGRAM ZA AUTOMATSKI UNOS **************

PROCEDURE LD42P()
   save screen to ekr1
   SET COLOR TO &BOJA1
   @ 9,9 clear TO 16,70
   @ 9,9 TO 16,70
   store 'Y' to od1,od2,od3

   SELECT 25
   TTLD=AAKTDIR+'\'+'TTLD.DBF'
   if NETUSE(TTLD,.F.,3)
   ELSE
      RETURN
   ENDIF
   KOJEJE=LMJE
   KOJEBR=LMBROJ
   KOJEIME=LMIME
   MPRAZ=EPRAZ
   MSATI=ESATI
   SELECT 25
   USE

   MESECB=ALLTRIM(KOJEBR)+'B'
   SELECT 1

   IF NETUSE(MESECB,.T.,3)
      SET order TO 1
   ELSE
      RETURN
   ENDIF
   MESEC=ALLTRIM(KOJEBR)
   SELECT 3
   IF NETUSE(MESEC,.T.,3)
      SET order TO 1
   ELSE
      RETURN
   ENDIF
   SELECT 2
   IF NETUSE('LDRAD.DBF',.T.,3)
      SET order TO 1
   ELSE
      RETURN
   ENDIF
   SELECT 1
   SET RELATION TO BR INTO B
   GO TOP
   MCASVR=0
   DO WHILE.NOT.EOF()
      MCASVR=MCASVR+CASVR
      SKIP
   ENDDO
   IF MCASVR>0
      @ 12,11 say'ZA  MESEC '+KOJEIME+' VEC SU UNETI CASOVI  '
      INKEY(0)
   ELSE
      @ 12,11 say' AUTOMATSKI UNOS CASOVA U PLATNI SPISAK '
      @ 13,11 say'ZA MESEC'
      @ 13,20 say kojeIME
      @ 14,11 say'   ZELITE LI AUTOMATSKI UNOS Y/N'get od1 picture 'Y'
      read
      if od1='Y'
         @ 15,2 SAY ' SACEKAJTE VRSI SE UNOS PODATAKA '
         IF KOJEJE=1.OR.KOJEJE=13
            MDANMES0=CTOD('01.01.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('31.01.'+STR(YEAR(DDAT1),4,0))
            MDANA=31
         ELSEIF KOJEJE=2.OR.KOJEJE=14
            MDANMES0=CTOD('01.02.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('28.02.'+STR(YEAR(DDAT1),4,0))
            MDANA=29
         ELSEIF KOJEJE=3.OR.KOJEJE=15
            MDANMES0=CTOD('01.03.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('31.03.'+STR(YEAR(DDAT1),4,0))
            MDANA=31
         ELSEIF KOJEJE=4.OR.KOJEJE=16
            MDANMES0=CTOD('01.04.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('30.04.'+STR(YEAR(DDAT1),4,0))
            MDANA=30
         ELSEIF KOJEJE=5.OR.KOJEJE=17
            MDANMES0=CTOD('01.05.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('31.05.'+STR(YEAR(DDAT1),4,0))
            MDANA=31
         ELSEIF KOJEJE=6.OR.KOJEJE=18
            MDANMES0=CTOD('01.06.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('30.06.'+STR(YEAR(DDAT1),4,0))
            MDANA=30
         ELSEIF KOJEJE=7.OR.KOJEJE=19
            MDANMES0=CTOD('01.07.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('31.07.'+STR(YEAR(DDAT1),4,0))
            MDANA=31
         ELSEIF KOJEJE=8.OR.KOJEJE=20
            MDANMES0=CTOD('01.08.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('31.08.'+STR(YEAR(DDAT1),4,0))
            MDANA=31
         ELSEIF KOJEJE=9.OR.KOJEJE=21
            MDANMES0=CTOD('01.09.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('30.09.'+STR(YEAR(DDAT1),4,0))
            MDANA=30
         ELSEIF KOJEJE=10.OR.KOJEJE=22
            MDANMES0=CTOD('01.10.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('31.10.'+STR(YEAR(DDAT1),4,0))
            MDANA=31
         ELSEIF KOJEJE=11.OR.KOJEJE=23
            MDANMES0=CTOD('01.11.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('30.11.'+STR(YEAR(DDAT1),4,0))
            MDANA=30
         ELSEIF KOJEJE=12.OR.KOJEJE=24
            MDANMES0=CTOD('01.12.'+STR(YEAR(DDAT1),4,0))
            MDANMES=CTOD('31.12.'+STR(YEAR(DDAT1),4,0))
            MDANA=31
         ENDIF
         select 1
         go top
         DO WHILE.NOT.EOF()
            MDANA2=0
            DDA=0
            IF B->DATZAPOS=CTOD('')
               DATZAPOS=MDANMES0
            ELSE
               IF B->DATZAPOS>=MDANMES0.AND.B->DATZAPOS<=MDANMES
                  DATZAPOS=B->DATZAPOS
               ELSE
                  IF B->DATZAPOS<MDANMES0
                     DATZAPOS=MDANMES0
                  ELSE
                     DDA=1
                  ENDIF
               ENDIF
            ENDIF

            IF B->DATOTKAZ=CTOD('')
               DATOTKAZ=MDANMES
            ELSE
               IF B->DATOTKAZ>=MDANMES0.AND.B->DATOTKAZ<=MDANMES
                  DATOTKAZ=B->DATOTKAZ
               ELSE
                  IF B->DATOTKAZ<MDANMES0
                     DDA=1
                  ELSE
                     DATOTKAZ=MDANMES
                  ENDIF
               ENDIF
            ENDIF
            IF DDA=0
               MDANA=DATOTKAZ-DATZAPOS+1
               MDANA2=0
               FOR I=1 TO MDANA
                  MDAN=DATZAPOS+I-1
                  MDOW=DOW(MDAN)
                  IF DOW(MDAN)>=2.AND.DOW(MDAN)<=6
                     MDANA2=MDANA2+8
                  ENDIF
               NEXT
               IF RECLOCK(3)
                  IF B->CIP=0
                     replace  casvr with MDANA2
                     replace  casuc with MDANA2
                     replace  casuK with CASVR
                  ELSE
                     replace  casvr with ROUND(ROUND(msati*B->CIP/100,0),0)
                     replace  casuc with ROUND(ROUND(msati*B->CIP/100,0),0)
                     replace  casuK with CASVR
                  ENDIF
                  UNLOCK
               ENDIF
            ENDIF
            SKIP
         ENDDO
      endif
   SELECT 1
   DELETE ALL FOR CASVR=0.AND.CASUC=0
   PACK
   SELECT 3
   SET RELATION  TO BR INTO A
   DELETE ALL FOR A->CASVR=0.AND.A->CASUC=0
   PACK
   ENDIF

   close all
   SET COLOR TO &BOJA2
   restore screen from ekr1
   return

   USE LD2POD
   COPY TO &MLDIPOD
   USE
PROCEDURE IPUNI(ABAZA,ABAZA1)
   MIMA=ABAZA+'.DBF'
   MIMA1=ABAZA1+'.DBF'
   IF FILE(MIMA)
      *MDA=AADATA0+'\'+MIMA1
      MDA=MIMA1
      IF FILE(MDA)
         MSEL=SELECT()
         SELECT 45
         USE &MIMA
         IF LASTREC()<1
         APPEND FROM &MDA
         ENDIF
         USE
         SELECT &MSEL
      ENDIF
   ENDIF
   RETURN

